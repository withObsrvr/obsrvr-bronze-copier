# Bronze Copier v1.1 - Overview

**Date:** 2025-11-23
**Author:** Tillman
**Appetite:** 2 weeks (1 cycle)

---

## Context

Bronze Copier v1.0 is complete and functional. During code review, several architectural improvements were identified that would make the system more robust for production use at scale.

This cycle addresses the remaining review feedback to bring Bronze Copier to full production-grade quality.

---

## What We're Solving

### Problem 1: Era Boundary Routing
Currently, the copier processes a single era at a time with manual configuration. There's no built-in support for:
- Automatic era detection based on protocol version
- Routing ledgers to correct era/version based on boundaries
- Running multiple eras concurrently with proper isolation

### Problem 2: Worker Pool Architecture
The current parallel committer works but lacks:
- Proper worker pool with bounded queues
- Explicit sequencer for PAS ordering (currently implicit)
- Per-partition retry with backoff
- Independent failure handling

### Problem 3: Observability
No structured logging or metrics:
- Using basic `log` package
- No Prometheus metrics
- No correlation IDs for tracing
- Hard to monitor in production

---

## Pitches for v1.1

| # | Pitch | Appetite | Risk | Dependencies |
|---|-------|----------|------|--------------|
| 06 | Era Boundary Config | 2 days | Low | None |
| 07 | Worker Pool + Sequencer | 3 days | Medium | None |
| 08 | Structured Logging | 2 days | Low | None |
| 09 | Prometheus Metrics | 2 days | Low | 08 |
| 10 | Atomic Storage Implementation | 2 days | Medium | None |

**Total:** ~11 days of work

---

## Success Criteria

### End of v1.1
- [ ] Era boundaries configurable, routing works automatically
- [ ] Worker pool with explicit sequencer for PAS ordering
- [ ] Structured JSON logging with correlation IDs
- [ ] Prometheus metrics endpoint (`/metrics`)
- [ ] Local storage implements AtomicStore interface

---

## What We're NOT Doing (Icebox)

These remain out of scope:
- Live gRPC streaming (archives first)
- Multiple Hubble tables (ledgers_lcm_raw only)
- Web monitoring UI
- IPFS pinning for PAS
- Multi-writer coordination

---

## Risk Register

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Era boundary complexity | Medium | Medium | Start simple - config only, no auto-detect |
| Worker pool deadlocks | Low | High | Use well-tested patterns, add timeouts |
| Logging performance | Low | Low | Use async logging, benchmark |

---

## Schedule

**Single 2-week cycle:**
- Days 1-2: Era Boundary Config
- Days 3-5: Worker Pool + Sequencer
- Days 6-7: Structured Logging
- Days 8-9: Prometheus Metrics
- Days 10-11: Atomic Storage + Integration Testing

**Cool-down (2-3 days):**
- Bug fixes
- Documentation updates
- Release prep
